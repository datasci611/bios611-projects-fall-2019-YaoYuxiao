---
title: "project3_report"
author: "YuxiaoYao"
date: "11/18/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Background
Non-profit Urban Ministries of Durham (UMD) connects poor and homeless neighbors to food, shelter and a future. They connect with the community to end homelessness and fight poverty by offering food, shelter and a future to neighbors in need. Here is the official website of UMD: http://www.umdurham.org/. This project is aiming to help UMD to improve their services and get prepared for future works.


# Datasets
Datasets are provided by UMD, which includes clients' information, entry and exit information, clients' health insurance conditions, income conditions and disability conditions at entry and at exit, provider information.  
Some variables are shown below:  

* CLIENT: Client ID, Client Age at Entry, Client Gender, Client Primary Race, Client Ethnicity, Client Veteran Status
* ENTRY_EXIT: Entry Date, Exit Date, Destination, Reason for Leaving
* EE_UDES: Client Location, Relationship to Head of Household, Prior Living Situation, Length of Stay in Previous Place
* HEALTH_INS_ENTRY: Covered (Entry), Health Insurance Type (Entry), Health Insurance Start Date (Entry)
* HEALTH_INS_EXIT: Covered (Exit), Health Insurance Type (Exit), Health Insurance Start Date (Exit)
* INCOME_ENTRY: Receiving Income (Entry), Income Source (Entry), Monthly Amount (Entry)
* INCOME_EXIT: Receiving Income (Exit), Income Source (Exit), Monthly Amount (Exit)


# Questions 
Here are some questions I am interested in:

1. Demographics
* What are the size, structure, and distribution of the clinet population at entry?
2. Entry and Exit
  + How many clients entried the UMD? What is the distribution of their entry time?
  + How long did they stay at the UMD?
  + Why did they leave the UMD?
3. Before and After
  + What are clients' health insurance conditions at entry and at exit? 
  + What are clients' income conditions at entry and at exit? 

# Data preparation

```{r prep ,include = FALSE,message=FALSE,warning=FALSE}
library(tidyverse)

merged_data=read_tsv("C:/Users/yaoyu/OneDrive/Documents/bios611-projects-fall-2019-YaoYuxiao/project_3/data/merged_data.tsv")
merged_data_client = read_tsv("C:/Users/yaoyu/OneDrive/Documents/bios611-projects-fall-2019-YaoYuxiao/project_3/data/merged_data_client.tsv")

# clean column names
names(merged_data)<-make.names(names(merged_data))
names(merged_data_client)<-make.names(names(merged_data_client))

str(merged_data_client)

demographic_data = merged_data_client %>%
  select(Client.ID,Client.Age.at.Entry,Client.Gender,Client.Primary.Race,Client.Ethnicity,Client.Veteran.Status)

demographic_data

ee_data = merged_data %>%
  select(Client.ID,Entry.Date,Exit.Date,Destination,Reason.for.Leaving,stay_days)
ee_data
```

# Demographics
### Age and Gender
```{r, echo=FALSE}
male_sub=subset(demographic_data,(Client.Gender == "Male"))

male_sub = male_sub%>%
  group_by(Client.Age.at.Entry) %>%
  summarise(count= -1 * n())


plot1.1=ggplot(demographic_data,mapping=aes(x=Client.Age.at.Entry))+
  geom_bar(subset(demographic_data,(Client.Gender == "Female")),mapping=aes(x=Client.Age.at.Entry),fill='pink2') + 
  geom_bar(male_sub,mapping=aes(x=Client.Age.at.Entry,y=count),stat = "identity",fill='skyblue2') +
  coord_flip()
  
plot1.1
```
### Race and Ethnicity
```{r, echo=FALSE}
race=demographic_data %>%
  drop_na()%>%
  group_by(Client.Primary.Race) %>%
  summarise(count= n())
race
# TODO remove (HUD)
plot1.2<- ggplot(race, aes(x="", y=count, fill=Client.Primary.Race))+
  geom_bar(width = 1, stat = "identity")+
  coord_polar("y", start=0)+
  scale_fill_brewer(palette = "YlGnBu") 
plot1.2

eth=demographic_data %>%
  drop_na()%>%
  group_by(Client.Ethnicity) %>%
  summarise(count= n())
eth
plot1.3<- ggplot(eth, aes(x="", y=count, fill=Client.Ethnicity))+
  geom_bar(width = 1, stat = "identity")+
  coord_polar("y", start=0)+
  scale_fill_brewer(palette = "YlGnBu") 
plot1.3
```
### Veteran Status
```{r, echo=FALSE}
veteran=demographic_data %>%
  drop_na()%>%
  group_by(Client.Veteran.Status) %>%
  summarise(count= n())

veteran

plot1.4<- ggplot(veteran, aes(x="", y=count, fill= Client.Veteran.Status))+
  geom_bar(width = 1, stat = "identity")+
  coord_polar("y", start=0)+
  scale_fill_brewer(palette = "YlGnBu") 
plot1.4
```

# Entry and Exit
### How many clients entried the UMD? 
```{r, echo=FALSE}
client_monthly=ee_data %>%
  separate(Entry.Date, sep = "-", into = c("Year", "Month", "Day"))%>%
  group_by(Year,Month) %>%
  summarise(client_sum=n())
client_monthly
client_monthly$yearmonth<-as.factor(paste(client_monthly$Year,client_monthly$Month,sep="-"))


plot2.1=ggplot(client_monthly,aes(as.numeric(yearmonth),client_sum))+
  geom_point()+
  geom_text(aes(label=client_sum),vjust=-0.8,size=3)+
  geom_line(size=1,color='skyblue3') +
  labs(x="Month",y="Client Number",title = "Fig2.1 Number of Clients Changes by Month")
plot2.1
```


### How long did they stay at the UMD?

### Why did they leave the UMD?

# Before and After
### What are clients' health insurance conditions at entry and at exit? 
### What are clients' income conditions at entry and at exit? 

# Conclusion and Discussion
